version: '3.8'

services:
  backend:
    build:
      context: .
      dockerfile: Dockerfile.backend
    # Optional: Removed port mapping. It's more secure to only expose the backend
    # to the internal Docker network, with NGINX as the single entry point.
    # If you need to access the API directly during development, you can add it back:
    ports:
      - "8080:8080"
    volumes:
      - ./database:/app/database
    restart: unless-stopped

  frontend:
    # This service builds the frontend assets and then runs NGINX
    # to serve them and act as a reverse proxy for the backend.
    build:
      context: ./frontend
      dockerfile: Dockerfile
    ports:
      - "80:80" # Expose NGINX to the world on port 80
    depends_on:
      - backend # The frontend/proxy needs the backend to be available
    restart: unless-stopped

# The original 'nginx' service is removed because the 'frontend' service
# already builds and runs a configured NGINX container.